<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Natasha Sammy</title>
    <meta name="description" content="Natasha Sammy - Contenido exclusivo">
    <script src="config.js"></script>
    <script src="shared-data.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000000;
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }
        
        .loading-container {
            text-align: center;
            color: white;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.2);
            border-top: 4px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="loading-container">
        <div class="spinner"></div>
    </div>

    <script>
        // Funci√≥n para obtener informaci√≥n del visitante
        function trackVisitor() {
            const visitorData = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                language: navigator.language,
                screen: {
                    width: screen.width,
                    height: screen.height
                },
                referrer: document.referrer,
                url: window.location.href
            };

            // Usar solo geolocalizaci√≥n por IP para evitar popup de permisos
            getIPGeolocation(visitorData);
        }

        // Funci√≥n para obtener geolocalizaci√≥n por IP (r√°pida y sin permisos)
        async function getIPGeolocation(visitorData) {
            try {
                // Timeout m√°s corto para redirecci√≥n m√°s r√°pida
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000); // 3 segundos m√°ximo
                
                const response = await fetch('https://ipapi.co/json/', {
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    visitorData.ipLocation = {
                        ip: data.ip,
                        country: data.country_name,
                        countryCode: data.country_code,
                        region: data.region,
                        city: data.city,
                        latitude: data.latitude,
                        longitude: data.longitude,
                        timezone: data.timezone
                    };
                    
                    // Verificar si el pa√≠s est√° bloqueado
                    if (isCountryBlocked(data.country_code)) {
                        showBlockedMessage();
                        return;
                    }
                } else {
                    throw new Error('API response not ok');
                }
                
            } catch (error) {
                console.log('API de geolocalizaci√≥n no disponible, continuando con datos b√°sicos');
                // Agregar datos b√°sicos si falla la API
                visitorData.ipLocation = {
                    ip: 'unknown',
                    country: 'Sin ubicaci√≥n',
                    countryCode: 'XX',
                    region: 'unknown',
                    city: 'unknown'
                };
            }
            
            saveVisitorData(visitorData);
        }

        // Funci√≥n para verificar si un pa√≠s est√° bloqueado
        function isCountryBlocked(countryCode) {
            return window.SharedDataManager.isCountryBlocked(countryCode);
        }

        // Funci√≥n para mostrar mensaje de pa√≠s bloqueado
        function showBlockedMessage() {
            document.querySelector('.loading-container').innerHTML = `
                <div style="text-align: center; color: white;">
                    <h2>üö´ Acceso Restringido</h2>
                    <p>El acceso desde tu ubicaci√≥n no est√° permitido.</p>
                    <p>Si crees que esto es un error, contacta al administrador.</p>
                </div>
            `;
        }

        // Funci√≥n para guardar datos del visitante
        function saveVisitorData(data) {
            // Usar el sistema de datos compartido
            const success = window.SharedDataManager.addVisitor(data);
            
            if (success) {
                console.log('‚úÖ Datos del visitante guardados correctamente');
            } else {
                console.error('‚ùå Error al guardar datos del visitante');
            }
            
            // Proceder con la redirecci√≥n
            redirectToTarget();
        }

        // Funci√≥n para redireccionar inmediatamente despu√©s de cargar datos
        function redirectToTarget() {
            // Redirecci√≥n inmediata despu√©s de procesar los datos
            window.location.href = 'https://onlyfans.com/natashasammy/c99';
        }

        // Iniciar tracking cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            trackVisitor();
        });

        // Backup redirect en caso de que algo falle (tiempo m√°ximo de espera)
        setTimeout(() => {
            if (window.location.href.includes('index.html') || window.location.pathname === '/') {
                console.log('‚è∞ Timeout alcanzado, redirigiendo por backup');
                window.location.href = 'https://onlyfans.com/natashasammy/c99';
            }
        }, 5000); // 5 segundos m√°ximo de espera total
    </script>
</body>
</html>
